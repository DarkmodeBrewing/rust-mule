<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>rust-mule::search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="/ui/assets/js/theme-init.js"></script>
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="/ui/assets/css/layout.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="/ui/assets/css/typography.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="/ui/assets/css/color-hc.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="/ui/assets/css/colors-light.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="/ui/assets/css/color-dark.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="/ui/assets/css/base.css"
    />
    <script defer src="/ui/assets/js/alpine.min.js"></script>
    <script type="module" src="/ui/assets/js/app.js"></script>
  </head>

  <body x-data="appSearch()" x-init="init()">
    <section class="container shell">
      <aside class="card sidebar">
        <h2>rust-mule</h2>
        <p>Search dashboard shell</p>
        <div class="flex gap-2 flex-wrap mt-3">
          <span
            class="badge"
            x-bind:class="sessionStateClass"
            x-text="sessionStateLabel"
          ></span>
          <button
            class="btn"
            type="button"
            @click="checkSession()"
            x-bind:disabled="sessionChecking"
          >
            Check
          </button>
          <button class="btn" type="button" @click="logoutSession()">
            Logout
          </button>
        </div>

        <h3 class="mt-4">Navigation</h3>
        <ul class="nav-list mt-3">
          <li><a href="/ui">Overview</a></li>
          <li><a href="/ui/search">Searches</a></li>
          <li><a href="/ui/node_stats">Nodes / Routing</a></li>
          <li><a href="/ui/log">Logs</a></li>
          <li><a href="/ui/settings">Settings</a></li>
        </ul>

        <h3 class="mt-4">Search Threads</h3>
        <ul class="search-list mt-3">
          <template x-if="searchThreads.length === 0">
            <li class="search-item">
              <small>No active keyword searches yet.</small>
            </li>
          </template>
          <template x-for="thread in searchThreads" :key="thread.search_id_hex">
            <li class="search-item">
              <div class="flex gap-3 flex-wrap">
                <a
                  x-bind:href="'/ui/search_details?searchId=' + thread.search_id_hex"
                >
                  <strong x-text="thread.search_id_hex"></strong>
                </a>
                <span
                  class="badge"
                  x-bind:class="thread.state_class"
                  x-text="thread.state"
                ></span>
              </div>
              <small>
                hits: <span x-text="thread.hits"></span> Â· age:
                <span x-text="thread.created_secs_ago"></span>s
              </small>
            </li>
          </template>
        </ul>

        <div class="mt-4">
          <button
            class="btn btn-primary"
            type="button"
            @click="startNewSearch()"
          >
            + New Search
          </button>
        </div>
      </aside>

      <main class="main-scroll grid gap-4">
        <div class="card">
          <h1>Keyword Search</h1>
          <p>
            First version: queue Kad keyword lookup and fetch cached hits by
            keyword hash.
          </p>
          <p class="mt-3" x-show="error" x-text="error"></p>
        </div>

        <div class="card">
          <h2>Search Form</h2>
          <form class="form-grid mt-3" @submit.prevent="submitSearch()">
            <div class="field">
              <label for="query">Keyword Query</label>
              <input
                id="query"
                class="input"
                type="text"
                placeholder="ubuntu iso"
                x-model="query"
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label for="keyword-id-hex">Keyword ID Hex (optional)</label>
              <input
                id="keyword-id-hex"
                class="input"
                type="text"
                placeholder="00112233445566778899aabbccddeeff"
                x-model="keywordIdHex"
                autocomplete="off"
              />
            </div>

            <div class="flex gap-3 flex-wrap">
              <button
                class="btn btn-primary"
                type="submit"
                x-bind:disabled="submitting || loading"
              >
                <span
                  x-text="submitting ? 'Searching...' : 'Search Keyword'"
                ></span>
              </button>
              <button
                class="btn"
                type="button"
                @click="refreshResults()"
                x-bind:disabled="submitting || loading"
              >
                Refresh Results
              </button>
            </div>
          </form>
        </div>

        <div class="card">
          <h2>Search Request</h2>
          <pre class="log" x-text="prettySearchResponse"></pre>
        </div>

        <div class="card">
          <h2>Keyword Hits</h2>
          <table class="table mt-3">
            <thead>
              <tr>
                <th>File Name</th>
                <th>Size</th>
                <th>Origin</th>
                <th>File ID</th>
              </tr>
            </thead>
            <tbody>
              <template
                x-if="!keywordResults || !keywordResults.hits || keywordResults.hits.length === 0"
              >
                <tr>
                  <td colspan="4">
                    No hits yet. Run search and refresh while the network
                    responds.
                  </td>
                </tr>
              </template>
              <template
                x-for="hit in ((keywordResults && keywordResults.hits) ? keywordResults.hits : [])"
                :key="hit.file_id_hex + hit.filename"
              >
                <tr>
                  <td x-text="hit.filename"></td>
                  <td x-text="hit.file_size"></td>
                  <td x-text="hit.origin"></td>
                  <td x-text="hit.file_id_hex"></td>
                </tr>
              </template>
            </tbody>
          </table>
          <p class="mt-3" x-show="activeKeywordIdHex">
            Active keyword id: <code x-text="activeKeywordIdHex"></code>
          </p>
        </div>
      </main>
    </section>
  </body>
</html>
